<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>KB Tracker – Dashboard</title>
    <style>
      :root {
        --bg: #0d0f14;
        --surface: #151820;
        --surface2: #1c1f2c;
        --border: #2a2d38;
        --accent: #ffe81f;
        --accent2: #c0a400;
        --text: #e8eaf0;
        --muted: #7a7e90;
        --win: #4caf68;
        --loss: #e05252;
        --draw: #7a7e90;
        --limited: #9b59b6;
        --font: 'Segoe UI', system-ui, sans-serif;
      }
      * { box-sizing: border-box; margin: 0; padding: 0; }

      body {
        font-family: var(--font);
        background: var(--bg);
        color: var(--text);
        min-height: 100vh;
      }

      /* ── Layout ── */
      .app { display: flex; height: 100vh; overflow: hidden; }

      nav {
        width: 200px;
        flex-shrink: 0;
        background: var(--surface);
        border-right: 1px solid var(--border);
        display: flex;
        flex-direction: column;
        overflow-y: auto;
      }

      .nav-logo {
        padding: 16px;
        font-size: 14px;
        font-weight: 800;
        color: var(--accent);
        letter-spacing: 0.1em;
        border-bottom: 1px solid var(--border);
      }

      .nav-github {
        display: flex;
        align-items: center;
        gap: 7px;
        padding: 8px 16px;
        font-size: 11px;
        color: var(--muted);
        text-decoration: none;
        transition: color 0.15s;
        margin-top: auto;
        border-top: 1px solid var(--border);
      }
      .nav-github:hover { color: var(--accent); }
      .nav-github svg { flex-shrink: 0; }

      .nav-section {
        padding: 10px 12px 4px;
        font-size: 9px;
        letter-spacing: 0.1em;
        text-transform: uppercase;
        color: var(--muted);
      }

      .nav-btn {
        display: block;
        width: 100%;
        background: none;
        border: none;
        padding: 8px 16px;
        text-align: left;
        font-size: 12px;
        color: var(--text);
        cursor: pointer;
        border-radius: 0;
        transition: background 0.1s;
      }
      .nav-btn:hover { background: var(--surface2); }
      .nav-btn.active { color: var(--accent); font-weight: 600; background: var(--surface2); }

      main {
        flex: 1;
        overflow-y: auto;
        padding: 24px 32px;
      }

      /* ── Filter bar ── */
      .filter-bar {
        display: flex;
        gap: 10px;
        align-items: center;
        margin-bottom: 20px;
        flex-wrap: wrap;
      }

      .filter-bar label { font-size: 11px; color: var(--muted); }

      .filter-bar select,
      .filter-bar input {
        background: var(--surface);
        border: 1px solid var(--border);
        color: var(--text);
        font-size: 11px;
        padding: 4px 8px;
        border-radius: 4px;
      }

      .filter-bar input[type="checkbox"] { accent-color: var(--accent); }

      /* ── Section title ── */
      h2 { font-size: 16px; margin-bottom: 14px; color: var(--accent); display: none; }
      h2.visible { display: block; }

      /* ── Stat cards ── */
      .stat-cards {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
        gap: 12px;
        margin-bottom: 24px;
      }
      .stat-card {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 6px;
        padding: 14px;
      }
      .stat-card .val { font-size: 28px; font-weight: 800; color: var(--accent); }
      .stat-card .lbl { font-size: 10px; color: var(--muted); margin-top: 4px; text-transform: uppercase; letter-spacing: 0.06em; }

      /* ── Overview leader breakdown ── */
      .ov-leaders-heading {
        font-size: 15px;
        font-weight: 700;
        color: var(--accent);
        margin: 4px 0 16px;
      }
      .ov-format-label {
        font-size: 12px;
        font-weight: 700;
        color: var(--text);
        margin-bottom: 12px;
      }
      .ov-leader-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
        gap: 14px;
        margin-bottom: 28px;
      }
      .ov-leader-card {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 6px;
        overflow: hidden;
      }
      .ov-leader-card-title {
        font-size: 11px;
        font-weight: 600;
        color: var(--accent);
        padding: 7px 9px 5px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .ov-leader-card img {
        display: block;
        width: 100%;
        aspect-ratio: 4/3;
        object-fit: cover;
        object-position: center 15%;
      }
      .ov-leader-card-img-placeholder {
        width: 100%;
        aspect-ratio: 4/3;
        background: var(--surface2);
      }
      .ov-leader-card-stats {
        padding: 8px 9px;
        font-size: 11px;
        color: var(--text);
        line-height: 1.6;
      }
      .ov-leader-stat-row { display: flex; gap: 16px; }
      .ov-leader-stat-val { font-weight: 700; color: var(--win); }
      .ov-leader-stat-val.loss { color: var(--loss); }
      .ov-leader-stat-val.neutral { color: var(--muted); }
      .table-wrap { overflow-x: auto; }
      table { width: 100%; border-collapse: collapse; font-size: 12px; }
      thead th {
        background: var(--surface);
        padding: 8px 10px;
        text-align: left;
        font-size: 10px;
        text-transform: uppercase;
        letter-spacing: 0.06em;
        color: var(--muted);
        border-bottom: 2px solid var(--border);
        white-space: nowrap;
        cursor: pointer;
        user-select: none;
      }
      thead th:hover { color: var(--accent); }
      thead th.sort-asc::after { content: ' ↑'; color: var(--accent); }
      thead th.sort-desc::after { content: ' ↓'; color: var(--accent); }
      tbody tr { border-bottom: 1px solid var(--border); transition: background 0.1s; }
      tbody tr:hover { background: var(--surface); }
      tbody tr.gh-row-hidden { opacity: 0.42; }

      /* ── Tools tab ── */
      .drop-zone {
        border: 2px dashed var(--border);
        border-radius: 8px;
        padding: 40px 24px;
        text-align: center;
        color: var(--muted);
        font-size: 13px;
        cursor: pointer;
        transition: border-color 0.2s, color 0.2s;
        margin-bottom: 24px;
      }
      .drop-zone:hover, .drop-zone.drag-over { border-color: var(--accent); color: var(--accent); }
      .drop-zone .drop-icon { font-size: 36px; display: block; margin-bottom: 8px; }
      .import-list { list-style: none; margin-bottom: 28px; display: flex; flex-direction: column; gap: 8px; }
      .import-source {
        background: var(--surface2);
        border: 1px solid var(--border);
        border-radius: 6px;
        padding: 10px 14px;
        display: grid;
        grid-template-columns: 1fr auto;
        align-items: center;
        gap: 8px;
      }
      .import-source .src-name { font-size: 12px; font-weight: 600; }
      .import-source .src-meta { font-size: 11px; color: var(--muted); margin-top: 2px; }
      .import-source .src-remove {
        background: none;
        border: 1px solid var(--border);
        color: var(--muted);
        border-radius: 3px;
        padding: 2px 8px;
        font-size: 11px;
        cursor: pointer;
      }
      .import-source .src-remove:hover { border-color: var(--loss); color: var(--loss); }
      .tools-section-heading {
        font-size: 11px;
        font-weight: 700;
        letter-spacing: 0.1em;
        text-transform: uppercase;
        color: var(--muted);
        margin-bottom: 14px;
        padding-bottom: 6px;
        border-bottom: 1px solid var(--border);
      }
      .merge-zone {
        border: 1px solid var(--loss);
        border-radius: 8px;
        padding: 20px 22px;
        margin-top: 32px;
        background: rgba(224,82,82,0.06);
      }
      .merge-zone h3 { color: var(--loss); font-size: 12px; text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 8px; }
      .merge-zone p { font-size: 12px; color: var(--muted); line-height: 1.5; margin-bottom: 14px; }
      #tools-merge-btn {
        background: none;
        border: 1px solid var(--loss);
        color: var(--loss);
        font-size: 12px;
        font-weight: 600;
        padding: 6px 16px;
        border-radius: 4px;
        cursor: pointer;
      }
      #tools-merge-btn:hover { background: var(--loss); color: #fff; }
      #tools-merge-btn:disabled { opacity: 0.4; cursor: default; }
      td { padding: 8px 10px; white-space: nowrap; }

      .gh-3dot {
        background: none;
        border: 1px solid var(--border);
        color: var(--muted);
        width: 26px; height: 22px;
        border-radius: 3px;
        cursor: pointer;
        font-size: 16px;
        line-height: 1;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 0;
      }
      .gh-3dot:hover { border-color: var(--accent); color: var(--accent); }

      #gh-popup-menu {
        position: fixed;
        background: var(--surface2);
        border: 1px solid var(--border);
        border-radius: 4px;
        z-index: 9999;
        display: none;
        flex-direction: column;
        min-width: 180px;
        box-shadow: 0 4px 16px rgba(0,0,0,0.55);
        padding: 4px 0;
      }
      #gh-popup-menu button {
        background: none;
        border: none;
        color: var(--text);
        padding: 8px 14px;
        text-align: left;
        font-size: 12px;
        cursor: pointer;
        white-space: nowrap;
        width: 100%;
      }
      #gh-popup-menu button:hover { background: var(--surface); }
      #gh-popup-menu button.danger { color: var(--loss); }
      #gh-popup-menu .menu-sep {
        height: 1px;
        background: var(--border);
        margin: 4px 0;
      }

      .win-rate-bar {
        display: flex;
        align-items: center;
        gap: 6px;
      }
      .bar-track {
        height: 6px;
        background: var(--border);
        border-radius: 3px;
        flex: 1;
        overflow: hidden;
      }
      .bar-fill { height: 100%; border-radius: 3px; background: var(--win); }

      /* ── Card image tooltip ── */
      .card-chip {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        position: relative;
        cursor: default;
      }

      .card-chip-img {
        width: 18px;
        height: 18px;
        border-radius: 2px;
        object-fit: cover;
        object-position: center top;
        vertical-align: middle;
        flex-shrink: 0;
      }

      .card-tooltip {
        display: none;
        position: fixed;
        z-index: 9999;
        pointer-events: none;
        border: 2px solid var(--border);
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 8px 32px rgba(0,0,0,0.7);
      }

      .card-tooltip img {
        display: block;
        width: 200px;
        height: auto;
      }

      /* ── Badges ── */
      .badge { display: inline-block; border-radius: 3px; padding: 1px 5px; font-size: 9px; font-weight: 700; text-transform: uppercase; }
      .badge.limited { background: var(--limited); color: #fff; }
      .badge.premier { background: var(--surface2); color: var(--muted); }
      .badge.eternal { background: #1a7fa0; color: #fff; }

      /* ── Game detail ── */
      #detail-view { display: none; }
      #detail-view.visible { display: block; }

      .detail-meta { font-size: 12px; color: var(--muted); margin-bottom: 16px; }
      .detail-meta strong { color: var(--text); }

      .log-wrap {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 6px;
        padding: 12px;
        max-height: 400px;
        overflow-y: auto;
        font-size: 11px;
        line-height: 1.6;
        color: var(--muted);
      }

      /* Hidden tabs */
      .tab-content { display: none; }
      .tab-content.active { display: block; }

      /* ── Card Stats two-panel layout ── */
      #tab-cards.active { display: flex; flex-direction: column; height: 100%; overflow: hidden; }

      .cs-layout {
        display: flex;
        flex: 1;
        gap: 0;
        overflow: hidden;
        min-height: 0;
      }

      /* Left: leader panel */
      .cs-left {
        width: 136px;
        flex-shrink: 0;
        background: var(--surface);
        border-right: 1px solid var(--border);
        display: flex;
        flex-direction: column;
        overflow-y: auto;
        padding: 8px 0;
      }
      .cs-panel-title {
        font-size: 9px;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        color: var(--muted);
        padding: 0 10px 8px;
        flex-shrink: 0;
      }
      .cs-leader-item {
        cursor: pointer;
        padding: 4px 8px;
        border-left: 3px solid transparent;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 3px;
        transition: background 0.1s;
      }
      .cs-leader-item:hover { background: var(--surface2); }
      .cs-leader-item.active { border-left-color: var(--accent); background: var(--surface2); }
      .cs-leader-item img {
        width: 110px;
        height: auto;
        border-radius: 4px;
        display: block;
      }
      .cs-leader-name {
        font-size: 9px;
        color: var(--muted);
        text-align: center;
        word-break: break-word;
        line-height: 1.3;
      }

      /* Right: header + card grid */
      .cs-right {
        flex: 1;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        min-width: 0;
      }
      .cs-right-header {
        display: flex;
        align-items: center;
        gap: 10px;
        flex-wrap: wrap;
        padding: 10px 16px;
        border-bottom: 1px solid var(--border);
        flex-shrink: 0;
        background: var(--surface);
      }
      .cs-right-title {
        font-size: 13px;
        font-weight: 700;
        color: var(--accent);
        flex-shrink: 0;
      }
      .cs-right-header label {
        font-size: 11px;
        color: var(--muted);
        display: flex;
        align-items: center;
        gap: 5px;
      }
      .cs-right-header select,
      .cs-right-header input[type="text"] {
        background: var(--surface2);
        border: 1px solid var(--border);
        color: var(--text);
        font-size: 11px;
        padding: 3px 7px;
        border-radius: 4px;
      }
      .cs-right-header input[type="checkbox"] { accent-color: var(--accent); }
      .cs-right-header button {
        background: var(--surface2);
        border: 1px solid var(--border);
        color: var(--text);
        padding: 4px 10px;
        font-size: 11px;
        border-radius: 4px;
        cursor: pointer;
      }
      .cs-right-header button:hover { border-color: var(--accent); color: var(--accent); }

      #cs-status {
        font-size: 11px;
        color: var(--muted);
        padding: 4px 16px;
        flex-shrink: 0;
        min-height: 20px;
      }

      /* Card grid */
      .cs-card-grid {
        flex: 1;
        overflow-y: auto;
        padding: 12px 16px;
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        align-content: flex-start;
      }

      .cg-item {
        position: relative;
        width: 148px;
        cursor: pointer;
        border-radius: 6px;
        overflow: hidden;
        background: var(--surface);
        border: 1px solid var(--border);
        transition: border-color 0.15s, transform 0.1s;
      }
      .cg-item:hover {
        border-color: var(--accent);
        transform: translateY(-2px);
      }
      .cg-card-img {
        display: block;
        width: 100%;
        height: 207px;
        object-fit: cover;
        object-position: center top;
      }
      .cg-footer {
        padding: 4px 6px 5px;
      }
      .cg-name {
        font-size: 9px;
        color: var(--muted);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        margin-bottom: 3px;
      }
      .cg-stat-bars {
        padding: 4px 6px 6px;
        display: flex;
        flex-direction: column;
        gap: 3px;
      }
      .cg-stat-row {
        display: flex;
        align-items: center;
        gap: 4px;
        font-size: 8px;
      }
      .cg-stat-label {
        width: 34px;
        flex-shrink: 0;
        color: var(--muted);
        text-transform: uppercase;
        letter-spacing: 0.04em;
        line-height: 1.2;
      }
      .cg-stat-track {
        flex: 1;
        height: 4px;
        background: var(--border);
        border-radius: 2px;
        overflow: hidden;
      }
      .cg-stat-fill {
        height: 100%;
        border-radius: 2px;
        transition: width 0.2s;
      }
      .cg-stat-val {
        font-size: 8px;
        flex-shrink: 0;
        min-width: 26px;
        text-align: right;
        font-weight: 600;
        color: var(--text);
      }
      /* keep legacy win-bar classes in case anything references them */
      .cg-win-bar-wrap { display:none; }


      /* Stats tooltip for card grid items */
      .cg-tooltip {
        display: none;
        position: fixed;
        z-index: 9999;
        pointer-events: none;
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 6px;
        padding: 8px 10px;
        font-size: 10px;
        color: var(--text);
        min-width: 160px;
        box-shadow: 0 8px 24px rgba(0,0,0,0.7);
        line-height: 1.9;
      }
      .cg-tooltip-row { display: flex; justify-content: space-between; gap: 12px; }
      .cg-tooltip-key { color: var(--muted); }
      .cg-tooltip-val { font-weight: 600; }

      /* ── Round Review Modal ── */
      .review-overlay {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.75);
        z-index: 10000;
        overflow-y: auto;
        padding: 24px 16px;
      }
      .review-overlay.open { display: flex; align-items: flex-start; justify-content: center; }

      .review-modal {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 8px;
        width: 100%;
        max-width: 1000px;
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }

      .review-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 14px 18px;
        border-bottom: 1px solid var(--border);
        background: var(--surface2);
        flex-shrink: 0;
      }
      .review-title { font-size: 13px; font-weight: 700; color: var(--accent); }
      .review-meta { font-size: 11px; color: var(--muted); margin-top: 2px; }
      .review-close {
        background: none;
        border: 1px solid var(--border);
        color: var(--muted);
        cursor: pointer;
        border-radius: 4px;
        padding: 4px 10px;
        font-size: 12px;
      }
      .review-close:hover { color: var(--text); border-color: var(--text); }

      .review-rounds {
        display: flex;
        gap: 6px;
        flex-wrap: wrap;
        padding: 10px 18px;
        border-bottom: 1px solid var(--border);
        background: var(--surface);
        flex-shrink: 0;
      }
      .review-pill {
        background: var(--surface2);
        border: 1px solid var(--border);
        color: var(--muted);
        padding: 4px 12px;
        font-size: 11px;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.1s;
      }
      .review-pill:hover { border-color: var(--accent); color: var(--accent); }
      .review-pill.active { background: var(--accent); color: #000; border-color: var(--accent); font-weight: 700; }
      .review-no-data { padding: 32px; text-align: center; color: var(--muted); font-size: 12px; }

      .review-body {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 0;
        overflow: hidden;
      }

      .review-player {
        padding: 16px;
        border-right: 1px solid var(--border);
        overflow-y: auto;
        max-height: calc(100vh - 200px);
      }
      .review-player:last-child { border-right: none; }

      .review-player-title {
        font-size: 11px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: var(--accent);
        margin-bottom: 12px;
        display: flex;
        align-items: center;
        gap: 6px;
      }
      .review-initiative { font-size: 9px; background: var(--accent); color: #000; padding: 1px 5px; border-radius: 3px; font-weight: 800; }

      .review-section {
        margin-bottom: 14px;
      }
      .review-section-title {
        font-size: 9px;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        color: var(--muted);
        margin-bottom: 6px;
        padding-bottom: 4px;
        border-bottom: 1px solid var(--border);
      }

      /* Stat row: label + value inline */
      .review-stat-row {
        display: flex;
        justify-content: space-between;
        font-size: 11px;
        padding: 2px 0;
      }
      .review-stat-label { color: var(--muted); }
      .review-stat-val { font-weight: 600; }

      /* HP bar */
      .review-hp-bar-wrap {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-top: 4px;
      }
      .review-hp-track {
        flex: 1;
        height: 8px;
        background: var(--border);
        border-radius: 4px;
        overflow: hidden;
      }
      .review-hp-fill {
        height: 100%;
        border-radius: 4px;
        background: var(--win);
        transition: width 0.3s;
      }
      .review-hp-fill.low { background: #e88010; }
      .review-hp-fill.critical { background: var(--loss); }
      .review-hp-text { font-size: 11px; font-weight: 700; min-width: 40px; text-align: right; }

      /* Card grid inside review */
      .review-cards {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
      }
      .review-card {
        position: relative;
        width: 70px;
        border-radius: 4px;
        overflow: hidden;
        border: 1px solid var(--border);
        background: var(--surface2);
        flex-shrink: 0;
      }
      .review-card.exhausted { opacity: 0.6; outline: 1px solid var(--muted); }
      .review-card.damaged { outline: 1px solid var(--loss); }
      .review-card img {
        display: block;
        width: 100%;
        height: 98px;
        object-fit: cover;
        object-position: center top;
      }
      .review-card-label {
        font-size: 8px;
        color: var(--muted);
        text-align: center;
        padding: 2px 3px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .review-card-damage {
        position: absolute;
        top: 2px;
        right: 2px;
        background: var(--loss);
        color: #fff;
        font-size: 8px;
        font-weight: 700;
        padding: 1px 4px;
        border-radius: 3px;
      }
      .review-card-placeholder {
        width: 70px;
        height: 98px;
        background: var(--surface2);
        border: 1px dashed var(--border);
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 9px;
        color: var(--muted);
        flex-shrink: 0;
      }
      .review-hand-count {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        background: var(--surface2);
        border: 1px solid var(--border);
        border-radius: 4px;
        padding: 4px 10px;
        font-size: 12px;
        font-weight: 700;
        color: var(--text);
        gap: 5px;
      }

      /* Initiative header — full width row at top of review-body */
      .review-initiative-header {
        grid-column: 1 / -1;
        background: var(--surface2);
        border-bottom: 1px solid var(--border);
        padding: 8px 16px;
        font-size: 11px;
        color: var(--muted);
        flex-shrink: 0;
      }
      .review-initiative-header strong { color: var(--accent); }

      /* Action log — full width row at bottom of review-body */
      .review-log {
        grid-column: 1 / -1;
        border-top: 1px solid var(--border);
        padding: 12px 16px;
        max-height: 220px;
        overflow-y: auto;
        background: var(--bg);
      }
      .review-log-line {
        font-size: 10px;
        color: var(--muted);
        padding: 2px 0;
        line-height: 1.5;
        border-bottom: 1px solid transparent;
      }
      .review-log-line:hover { color: var(--text); }
      .review-log-empty {
        font-size: 11px;
        color: var(--muted);
        font-style: italic;
      }

      /* ── Per-round stat charts ── */
      .review-charts {
        border-bottom: 1px solid var(--border);
        padding: 10px 18px 8px;
        background: var(--bg);
        flex-shrink: 0;
      }
      .review-chart-legend {
        font-size: 10px;
        color: var(--muted);
        margin-bottom: 6px;
        display: flex;
        align-items: center;
      }
      .review-chart-grid {
        display: flex;
        flex-wrap: nowrap;
        gap: 14px;
        overflow-x: auto;
        padding-bottom: 4px;
      }
      .review-chart-wrap { flex-shrink: 0; }
      .review-chart-title {
        font-size: 8px;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        color: var(--muted);
        margin-bottom: 2px;
        font-weight: 600;
        text-align: center;
      }

      /* ── Print / PDF export ── */
      #print-area { display: none; }

      @media print {
        /* Hide everything except the print area */
        body > * { display: none !important; }
        #print-area {
          display: block !important;
          font-family: system-ui, sans-serif;
          font-size: 11px;
          color: #111;
          background: #fff;
        }

        /* Each .print-page gets its own physical page */
        .print-page {
          page-break-after: always;
          break-after: page;
          padding: 24px 28px;
          max-width: 100%;
          box-sizing: border-box;
        }
        .print-page:last-child { page-break-after: avoid; break-after: avoid; }

        /* Cover page */
        .print-cover-title { font-size: 22px; font-weight: 700; margin-bottom: 4px; }
        .print-cover-meta { font-size: 12px; color: #555; margin-bottom: 24px; }
        .print-cover-charts { margin-top: 12px; }
        .print-cover-charts .review-chart-grid { flex-wrap: wrap; overflow: visible; gap: 10px; }
        .print-cover-charts .review-chart-title { color: #555; }

        /* Round page header */
        .print-round-header {
          font-size: 15px;
          font-weight: 700;
          border-bottom: 2px solid #333;
          padding-bottom: 4px;
          margin-bottom: 10px;
        }
        .print-initiative-note {
          font-size: 10px;
          color: #555;
          margin-bottom: 10px;
        }

        /* Two-column player layout */
        .print-players {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 16px;
          margin-bottom: 12px;
        }
        .print-player-title {
          font-size: 11px;
          font-weight: 700;
          text-transform: uppercase;
          letter-spacing: 0.07em;
          color: #333;
          margin-bottom: 6px;
          border-bottom: 1px solid #ccc;
          padding-bottom: 3px;
        }
        .print-section { margin-bottom: 8px; }
        .print-section-title {
          font-size: 8px;
          text-transform: uppercase;
          letter-spacing: 0.1em;
          color: #888;
          margin-bottom: 3px;
        }
        .print-stat-row {
          display: flex;
          justify-content: space-between;
          font-size: 10px;
          padding: 1px 0;
        }
        .print-stat-label { color: #666; }
        .print-stat-val { font-weight: 600; }
        .print-hp-bar-wrap { display: flex; align-items: center; gap: 6px; margin: 2px 0; }
        .print-hp-track { flex: 1; height: 6px; background: #ddd; border-radius: 3px; overflow: hidden; }
        .print-hp-fill { height: 100%; border-radius: 3px; }
        .print-hp-text { font-size: 10px; font-weight: 700; min-width: 36px; text-align: right; }
        .print-cards { display: flex; flex-wrap: wrap; gap: 4px; margin-top: 2px; }
        .print-card {
          position: relative;
          width: 52px;
          border: 1px solid #ccc;
          border-radius: 3px;
          overflow: hidden;
          page-break-inside: avoid;
          break-inside: avoid;
        }
        .print-card img { display: block; width: 100%; height: 72px; object-fit: cover; object-position: center top; }
        .print-card-label { font-size: 6px; color: #666; text-align: center; padding: 1px 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .print-card-damage {
          position: absolute; top: 1px; right: 1px;
          background: #c0392b; color: #fff;
          font-size: 7px; font-weight: 700;
          padding: 0 3px; border-radius: 2px;
        }
        .print-card.exhausted { opacity: 0.55; }
        .print-card-placeholder { width: 52px; height: 72px; background: #f0f0f0; border: 1px dashed #ccc; border-radius: 3px; display: flex; align-items: center; justify-content: center; font-size: 8px; color: #999; }
        .print-initiative-badge { display: inline-block; background: #333; color: #fff; font-size: 8px; font-weight: 700; padding: 1px 5px; border-radius: 3px; margin-left: 6px; }

        /* Action log */
        .print-log { margin-top: 8px; padding-top: 6px; border-top: 1px solid #ddd; }
        .print-log-title { font-size: 8px; text-transform: uppercase; letter-spacing: 0.1em; color: #888; margin-bottom: 4px; }
        .print-log-line { font-size: 9px; color: #444; line-height: 1.5; }
      }
  </style>
  </head>
  <body>
    <div class="app">
      <nav>
        <div class="nav-logo">⚡ KB TRACKER</div>
        <div class="nav-section">Views</div>
        <button class="nav-btn active" data-tab="overview">Overview</button>
        <button class="nav-btn" data-tab="matchups">Matchups</button>
        <button class="nav-btn" data-tab="cards">Card Stats</button>
        <button class="nav-btn" data-tab="history">Game History</button>
        <div class="nav-section">Tools</div>
        <button class="nav-btn" data-tab="tools">Import &amp; Aggregate</button>
        <button class="nav-btn" id="export-btn">Export DB</button>
        <a class="nav-github" href="https://github.com/DanielValencia92/KB-Tracker" target="_blank" rel="noopener">
          <svg width="15" height="15" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
            <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38
              0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13
              -.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66
              .07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15
              -.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27
              .68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12
              .51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48
              0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
          </svg>
          GitHub
        </a>
      </nav>
      <main>
        <!-- ─ OVERVIEW ───────────────────────────────────── -->
        <div class="tab-content active" id="tab-overview">
          <h2 class="visible">Overview</h2>
          <div class="filter-bar">
            <label>Format:
              <select id="ov-format">
                <option value="">All</option>
                <option value="premier">Premier</option>
                <option value="limited">Limited</option>
                <option value="eternal">Eternal</option>
              </select>
            </label>
            <label>Player name: <input type="text" id="ov-player-name" placeholder="(all)"></label>
          </div>
          <div class="stat-cards" id="ov-stat-cards"></div>
          <div id="ov-leader-section"></div>
        </div>

        <!-- ─ MATCHUPS ──────────────────────────────────── -->
        <div class="tab-content" id="tab-matchups">
          <h2 class="visible">Matchups</h2>
          <div class="filter-bar">
            <label>Format:
              <select id="mu-format">
                <option value="">All</option>
                <option value="premier">Premier</option>
                <option value="limited">Limited</option>
                <option value="eternal">Eternal</option>
              </select>
            </label>
            <label>Player: <input type="text" id="mu-player-name" placeholder="(all)"></label>
            <button id="mu-refresh" style="background:var(--surface);border:1px solid var(--border);color:var(--text);padding:4px 10px;font-size:11px;border-radius:4px;cursor:pointer">Refresh</button>
          </div>
          <div class="table-wrap">
            <table id="mu-table">
              <thead>
                <tr>
                  <th data-col="yourLeaderName">Your Leader</th>
                  <th data-col="opponentLeaderName">Opponent Leader</th>
                  <th data-col="wins">W</th>
                  <th data-col="losses">L</th>
                  <th data-col="draws">D</th>
                  <th data-col="totalGames">Total</th>
                  <th data-col="winRate">Win Rate</th>
                </tr>
              </thead>
              <tbody id="mu-body"></tbody>
            </table>
          </div>
        </div>

        <!-- ─ CARD STATS ─────────────────────────────────── -->
        <div class="tab-content" id="tab-cards">
          <div class="cs-layout">
            <!-- Left: leader selector -->
            <div class="cs-left" id="cs-leaders">
              <div class="cs-panel-title">Leaders</div>
              <!-- populated by JS -->
            </div>

            <!-- Right: header + card grid -->
            <div class="cs-right">
              <div class="cs-right-header">
                <div class="cs-right-title" id="cs-leader-title">All Leaders</div>
                <label>Base:
                  <select id="cs-base-color">
                    <option value="">(all bases)</option>
                  </select>
                </label>
                <label>Sort:
                  <select id="cs-sort">
                    <option value="winRateWhenPlayed">Win % (played)</option>
                    <option value="winRateWhenDrawn">Win % (drawn)</option>
                    <option value="playRate">Play rate</option>
                    <option value="resourceRate">Resource rate</option>
                    <option value="avgCopiesPerGame">Avg copies</option>
                    <option value="avgRoundPlayed" data-sort-asc>Avg round played</option>
                    <option value="gamesAppeared">Appearances</option>
                  </select>
                </label>
                <label>Format:
                  <select id="cs-format">
                    <option value="">All</option>
                    <option value="premier">Premier</option>
                    <option value="limited">Limited</option>
                    <option value="eternal">Eternal</option>
                  </select>
                </label>
                <label>Player: <input type="text" id="cs-player-name" placeholder="(all)"></label>
                <button id="cs-refresh">Refresh</button>
              </div>
              <div id="cs-status"></div>
              <div id="cs-card-grid" class="cs-card-grid"></div>
            </div>
          </div>
        </div>

        <!-- ─ GAME HISTORY ───────────────────────────────── -->
        <div class="tab-content" id="tab-history">
          <h2 class="visible">Game History</h2>
          <div class="filter-bar">
            <label>Format:
              <select id="gh-format">
                <option value="">All</option>
                <option value="premier">Premier</option>
                <option value="limited">Limited</option>
                <option value="eternal">Eternal</option>
              </select>
            </label>
          </div>
          <div class="table-wrap">
            <table id="gh-table">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Format</th>
                  <th>Your Leader</th>
                  <th>Opponent Leader</th>
                  <th>Result</th>
                  <th>Rounds</th>
                  <th></th>
                </tr>
              </thead>
              <tbody id="gh-body"></tbody>
            </table>
          </div>
        </div>

        <!-- ─ TOOLS ─────────────────────────────────────── -->
        <div class="tab-content" id="tab-tools">
          <h2 class="visible">Import &amp; Aggregate</h2>

          <div class="drop-zone" id="tools-drop-zone">
            <span class="drop-icon">&#x1F4E5;</span>
            Drop KB Tracker JSON export files here, or <strong>click to browse</strong>
            <input type="file" id="tools-file-input" multiple accept=".json" style="display:none">
          </div>

          <div id="tools-sources-wrap" style="display:none">
            <div class="tools-section-heading">Loaded Sources</div>
            <ul class="import-list" id="tools-import-list"></ul>

            <div class="tools-section-heading">Aggregate Stats</div>
            <div id="tools-agg-summary"></div>
            <div class="stat-cards" id="tools-agg-stat-cards" style="margin-bottom:28px"></div>
            <div id="tools-agg-leader-section"></div>

            <div class="merge-zone">
              <h3>&#x26A0; Danger Zone &mdash; Merge to Local Database</h3>
              <p>
                Merging will permanently add all imported games to your local database.
                Games already present (matching game ID) will be skipped automatically.
                <strong>This cannot be undone.</strong>
              </p>
              <button id="tools-merge-btn">&#x1F4BE; Merge All Imports into Local DB</button>
            </div>
          </div>
        </div>
      </main>
    </div>
    <script type="module" src="./dashboard.ts"></script>
    <!-- Game history 3-dot popup menu -->
    <div id="gh-popup-menu">
      <button id="gh-menu-review">&#9654; Review</button>
      <button id="gh-menu-format">&#10227; Change Format</button>
      <div class="menu-sep"></div>
      <button id="gh-menu-hide">&#x1F648; Hide from Stats</button>
      <button id="gh-menu-delete" class="danger">&#x26D4; Delete</button>
    </div>
    <!-- Shared card image tooltip element -->
    <div class="card-tooltip" id="card-tooltip"><img id="card-tooltip-img" src="" alt="" /></div>
    <!-- Round review modal -->
    <div class="review-overlay" id="review-overlay">
      <div class="review-modal" id="review-modal">
        <div class="review-header">
          <div>
            <div class="review-title" id="review-title">Round Review</div>
            <div class="review-meta" id="review-meta"></div>
          </div>
          <div style="display:flex;gap:8px;align-items:center">
            <button class="review-close" id="review-export-pdf" style="background:var(--surface2);border-color:var(--accent);color:var(--accent)">⬇ Export PDF</button>
            <button class="review-close" id="review-close">✕ Close</button>
          </div>
        </div>
        <div class="review-rounds" id="review-rounds"></div>
        <div class="review-charts" id="review-charts"></div>
        <div class="review-body" id="review-body"></div>
      </div>
    </div>
    <!-- Print area (hidden normally, shown only on print) -->
    <div id="print-area"></div>
  </body>
</html>
